<!DOCTYPE html>
<html>
  <head>
    <script src="./compiler.js"></script>
    <script src="./r3www.js"></script>    

<script>
function dumpmd() { var s="";
	for(var i=0;i<memd;i++) {
		s=s+" "+mem.getInt8(i);
		}
	return s;
	}

function dumpmc() {	var s="";
	for(var i=0;i<memc;i++) {
		if (i==ip) { s+=" >"; } else { s+=" "; } 
		s+=printmr3(memcode[i]);
		if (i==ip) { s+="<"; }
		}
	return s;
	}

function dumpblock(){ var s="";
	for (var i=0;i<stackbl.length;i++) {
		s+=" "+stackbl[i]+"("+stacka[i]+")";
		}
	return s;
	}	
	
function dumpVM() {
	const setDiv = (id, value) => document.getElementById(id).innerText = value;
	setDiv("ip", ip);
	setDiv("ds", [TOS, ...(stack.slice(2, NOS+1).reverse())].join(" "));
    setDiv("cs", stack.slice(RTOS,256).join(" "));
    setDiv("mc", dumpmc());
    setDiv("md", dumpmd());
    setDiv("bl", dumpblock());
	setDiv("dic",dicc.join(" "));
    }

function r3Compile() { 
	r3reset();r3token(document.getElementById("srccode").value);dumpVM(); 
	}
	
function r3Run() { 
	r3reset();r3token(document.getElementById("srccode").value);r3run();dumpVM(); 
	}
</script>

<style>	
table td, table td * { vertical-align: top; }	
</style>

  </head>
<body bgcolor="#333"><font face="Arial" color="#fff">
r3)
<button onclick=""> NONAME </button>

<button onclick="r3Compile();">Compile</button>    
<button onclick="r3step();dumpVM();redraw();">Step</button>
<button onclick="r3Run();redraw();">Run</button>

<br>
	<table><tr><td>

<textarea id="srccode" rows="20" style="color:#fff;background-color:#666;">| comentario

#v $ff00 $ff

:cua 
 dup * ;
 
:line
 3 
 4 <? ( 1 + )
 5 >? ( 1 + )
 drop
 
 0 ( $1ff <? 
  $ff00 over !
  1 + ) drop ;

 %..1..  
 %.111.
 %..1..
 line ;

</textarea>

<!--
<input type="text" value=""><br>
<button onclick="r3run();dumpVM();">Run</button><br>
--> 

	</td><td>
<canvas id="canvas" height="640" width="480"></canvas>

	</td><td>
DATA STACK:<div id="ds"></div><br>
CODE STACK:<div id="cs"></div><br>
IP:<div id="ip"></div><br>    
MEMCODE:<div id="mc"></div><br>
MEMDATA:<div id="md"></div><br>
DICC:<div id="dic"></div><br>
(stack):<div id="bl"></div><br>
ERR:<div id="logerror"></div><br>
</td></tr>
	</table>
	
  </body>
</html>