<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>r3</title>


  <link rel="stylesheet" href="./use/bulma.min.css" />
  <link rel="stylesheet" href="./use/ico.css" />

  <link rel="stylesheet" href="./use/codemirror.css" />
<!--  <link rel="stylesheet" href="./use/colorforth.css">  -->
  <script src="use/codemirror.js"></script>


    <script src="./compiler.js"></script>
    <script src="./runner.js"></script>
    <link rel="import" href="./components/r3-runner.html">
    <link rel="import" href="./components/r3-canvas.html">
    <link rel="import" href="./components/r3-show.html">
    <link rel="import" href="./components/r3-error.html">
    <link rel="import" href="./components/r3-editor.html">

</head>
<body>
  <nav class="navbar" role="navigation">
  <a class="navbar-item" href="https://github.com/r3www/r3">r3</a>

    <div id="navbarMenu" class="navbar-menu">

      <div class="navbar-start">
        <div class="navbar-item">
      <div class="buttons">

  <button is="r3-runner-button" type="run" class="button is-success">
    <i class="ico icon-play"></i>
  </button>

  <button is="r3-runner-button" type="playintab" class="button is-success">
    <i class="ico icon-play"></i>
    <i class="ico icon-window-maximize"></i>
  </button>

  <button is="r3-runner-button" type="compile" class="button is-success">
    <i class="ico icon-cog"></i>
  </button>

  <button is="r3-runner-button" type="step" class="button is-success">
    <i class="ico icon-right-open"></i>
  </button>

<!-- <button class="button">Includes</button> -->

          <div class="dropdown is-hoverable">
            <div class="dropdown-trigger">
              <button
                class="button"
                aria-haspopup="true"
                aria-controls="dropdown-menu">
                <span>Examples</span>
                <span class="icon is-small">
          <i class="ico icon-down-dir"></i>
                </span>
              </button>
            </div>

            <div
              class="dropdown-menu"
              id="dropdown-menu"
              role="menu">
              <div class="dropdown-content">
                <a href="#" class="dropdown-item" onclick="r3Editor.item = 'r3/examples/Pattern-XOR-in-canvas.r3';">Pattern XOR in canvas</a>
                <a href="#" class="dropdown-item" onclick="r3Editor.item = 'r3/examples/Font-test.r3';">Font test</a>
                <a href="#" class="dropdown-item" onclick="r3Editor.item = 'r3/examples/DOM-test.r3';">DOM test</a>
                <a href="#" class="dropdown-item" onclick="r3Editor.item = 'r3/examples/SHOW-test.r3';">SHOW test</a>
                <a href="#" class="dropdown-item" onclick="r3Editor.item = 'r3/examples/XYMOUSE-test.r3';">XYMOUSE test</a>
              </div>
            </div>
          </div>

      </div>
        </div>
      </div>

      <div class="navbar-end">
        <a class="navbar-item">No Docs</a>
        <a class="navbar-item">No Settings</a>
      </div>

    </div>
  </nav>

  <div class="columns">
    <div class="column is-quarter">
        <div is="r3-editor" item="src"></div>
        <div> IP:<span id="ip" class="tag is-warning"></span>
          <span is="r3-error" id="logerror"></span>
        </div>
    <div>D:<span id="ds"></span><br></div>
    <div>R:<span id="cs"></span><br></div>

    </div>

  <div class="column">
    <div id="r3dom"></div>
    <div id="r3canvas" >
      <canvas id="canvas" width="512" height="512" is="r3-canvas"></canvas>
    </div>
  </div>

    <div class="column">
      <div class="panel" style="font-family:Monospace;">


<div id="dic"></div><br>

MEMCODE:<div id="mc" ></div><br>
MEMDATA:<div id="md"></div><br>

      </div>
    </div>
  </div>

<script>
// DEBUG
//----------------------------------------------------
function dumpmd() { var s="";
  for(var i=meminidata;i<memd;i++) { s=s+" "+mem.getInt8(i); }
  return s;
  }

function dumpmc() { var s="";
  for(var i=0;i<memc;i++) {
    if (i==ip) { s+=" >>"; }
    s+=printmr3(memcode[i])+" ";
    if (i==ip) { s+="<< "; }
//    s+="\n";
    }
  return s;
  }

function dumpinc() { var s="";
//  for(var i=0;i<localStorage.length;i++) { s+=localStorage.key(i)+"\n"+localStorage.getItem(localStorage.key(i))+"\n"; }
  for (var i=0;i<includes.length;i++) { s+=includes[i]+"\n"; }
  return s;
  }

function dumpds() { var s="";
  if (NOS==0) {return s;}
  s+='<span class="tag is-success">'+TOS+'</span>';
  for (var i=NOS;i>1;i--) { s+='<span class="tag is-success">'+stack[i]+'</span>';}
  return s;
  }

function dumpcs() { var s="";
  for (var i=RTOS;i<254;i++) { s+='<span class="tag is-link">'+stack[i]+'</span>';}
  return s;
  }

function dumpdic() { var s="";
  s+="<table class='table is-bordered is-striped is-narrow is-hoverable is-fullwidth'>";
  for (var i=0;i<dicc.length;i++) {
  s+="<tr>";
  s+="<td>"+dicc[i]+"</td><td>"+dicca[i]+":"+dicci[i]+"</td><td>"+dicci[i]+"</td>";
  s+="</tr>";
  }
  s+="</table>";
  return s;
  }
function dumpip () {return ip;}

function dumpVM() {
  const t = "innerText";
  const h = "innerHTML";
  for (let [what, innerProp] of Object.entries({
    ip: t,
    ds: h,
    cs: h,
    dic: h,
    mc: t,
    md: t
  })) {
    document.getElementById(what)[innerProp] = window[`dump${what}`]();
  }
}

// VM
//----------------------------------------------------
//  Includes
//----------------------------------------------------

async function loadincludes() {
  if (window.localStorage == null) { alert("error de confianza");return; }
  let libsText = await(await fetch("./r3/libs.txt")).text();
  for (let libname of libsText.trim().split("\n")) {
    libname="r3/"+libname.trim();
    localStorage.setItem(libname,await (await fetch(libname)).text());
  }
dumpVM();
}


//----------------------------------------------------
// PLAY IN TAB
//----------------------------------------------------

/////////
// BOOT//
/////////
localStorage.clear();

loadincludes();

</script>

  </body>
</html>
